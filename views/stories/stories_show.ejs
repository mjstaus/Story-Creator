<%-include("../partials/_header")%>

<div class="main stories_show">

  <div class="container">
    <h1><%= data[0].title %></h1>
    <div class="story_header">
      <div class="story_author">
        <img class="avatar" src= <%= data[0].avatar %>>
        <p><%= data[0].creator_name %></p>
      </div>
      <div class="story_status">
        <div>
          <!-- Complete Story Button (If user = creator, hard coded to users.id 1) -->
          <% if(data[0].user_id === 1 && !data[0].complete){%>
            <form action="/stories/<%=data[0].id%>" method="POST">
            <button class="button">Finalize Story</button>
            </form>
          <% }%>
        </div>
        <div>
          <!-- Complete vs. incomplete icons -->
          <% if(!data[0].complete){%>
            <img src="/images/open_book.png" class="story_book">
          <% } else if (data[0].complete) { %>
            <img src="/images/closed_book.png" class="story_book">
          <%}%>
        </div>
      </div>
    </div>
  </div>

  <div class="initial_content">
    <!-- Initial content -->
    <p><%= data[0].initial_content %></p>
  </div>

  <!-- Accepted contributions -->
  <div class="content">
    <% for (let d of data) { if(d.accepted){%>
    <p><%= d.content%></p>
    <%}}%>
  </div>
  <!-- Submit New Contribution -->

  <% if(!data[0].complete){%>
  <form action="/stories/<%=data[0].id%>/contributions" method="POST" class="submit_contribution">
    <label for="content"></label>
    <input type="text" name="content" placeholder="What happens next?" />
    <div class="submit_contribution_button">
      <button type="submit" class="button">Submit</button>
    </div>
  </form>
  <% }%>

  <!-- Pending Submissions -->
<% for (let d of data) {
  if(d.content && !d.accepted && !d.archived && !data[0].complete){%>
    <div class="pending">
      <div class="contributor">
        <img class="avatar" src= <%= d.contributor_avatar %>>
        <p><%= d.contributor %></p>
      </div>
      <p><%= d.content %></p>
      <div class="likes_accept">
        <div class="votes">
          <% if(!data[0].complete){%>
          <form action="/stories/contributions/<%=d.contribution_id%>/vote" method="POST">
            <input type="image" src="/images/heart.png" class="upvote">
          </form>
          <% }%>
          <p><%= d.votes %></p>
        </div>
        <% if(data[0].user_id === 1 && !data[0].complete){%>
          <form action="/stories/contributions/<%=d.contribution_id%>" method="POST">
            <button class="button">Accept Contribution</button>
          </form>
      </div>
    </div>
  <% }%>
<%}}%>




</div>

<%-include("../partials/_footer")%>
